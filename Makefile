# Kumihan-Formatter Makefile

# Pythonç’°å¢ƒè¨­å®š
PYTHON = python3
PIP = $(PYTHON) -m pip

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š
PROJECT_NAME = kumihan_formatter
SRC_DIR = $(PROJECT_NAME)

.PHONY: help setup clean lint test test-unit test-integration test-performance test-coverage

# ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¿ãƒ¼ã‚²ãƒƒãƒˆ
help:
	@echo "Kumihan-Formatter Build System"
	@echo ""
	@echo "åŸºæœ¬ã‚³ãƒãƒ³ãƒ‰:"
	@echo "  make setup         - é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—"
	@echo "  make lint          - ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯"
	@echo "  make test          - å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ"
	@echo "  make test-unit     - ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œ"
	@echo "  make test-integration - çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œ"
	@echo "  make test-performance - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ"
	@echo "  make test-coverage - ã‚«ãƒãƒ¬ãƒƒã‚¸ä»˜ããƒ†ã‚¹ãƒˆå®Ÿè¡Œ"
	@echo "  make clean         - ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤"
	@echo ""

# åŸºæœ¬ã‚³ãƒãƒ³ãƒ‰å®Ÿè£…
setup:
	@echo "ğŸš€ é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ä¸­..."
	$(PIP) install -e .
	$(PIP) install -r requirements-dev.txt
	@echo "âœ… ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å®Œäº†"

lint:
	@echo "ğŸ” ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯ä¸­..."
	$(PYTHON) -m black --check $(SRC_DIR)
	$(PYTHON) -m isort --check-only $(SRC_DIR)
	$(PYTHON) -m flake8 $(SRC_DIR)
	$(PYTHON) -m mypy $(SRC_DIR)
	@echo "âœ… ãƒªãƒ³ãƒˆãƒã‚§ãƒƒã‚¯å®Œäº†"

# ãƒ†ã‚¹ãƒˆã‚³ãƒãƒ³ãƒ‰å®Ÿè£…
test:
	@echo "ğŸ§ª å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­..."
	$(PYTHON) -m pytest
	@echo "âœ… ãƒ†ã‚¹ãƒˆå®Œäº†"

test-unit:
	@echo "ğŸ”¬ ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­..."
	$(PYTHON) -m pytest tests/unit -m unit
	@echo "âœ… ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆå®Œäº†"

test-integration:
	@echo "ğŸ”— çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­..."
	$(PYTHON) -m pytest tests/integration -m integration
	@echo "âœ… çµ±åˆãƒ†ã‚¹ãƒˆå®Œäº†"

test-performance:
	@echo "âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­..."
	$(PYTHON) -m pytest tests/performance -m performance --benchmark-only
	@echo "âœ… ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆå®Œäº†"

test-coverage:
	@echo "ğŸ“Š ã‚«ãƒãƒ¬ãƒƒã‚¸ä»˜ããƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­..."
	$(PYTHON) -m pytest --cov=$(SRC_DIR) --cov-report=html --cov-report=term-missing
	@echo "âœ… ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ†ã‚¹ãƒˆå®Œäº†"

clean:
	@echo "ğŸ§¹ ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤ä¸­..."
	find . -type f -name "*.pyc" -delete
	find . -type d -name "__pycache__" -delete
	find . -type d -name "*.egg-info" -exec rm -rf {} +
	rm -rf htmlcov/
	rm -rf .coverage
	rm -rf .pytest_cache/
	@echo "âœ… ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Œäº†"