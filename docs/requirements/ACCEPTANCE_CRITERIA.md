# 受け入れ条件 - Kumihan-Formatter

## 1. 概要

このドキュメントは、Kumihan-Formatterの各機能に対する詳細な受け入れ条件を定義します。各条件は具体的で測定可能、達成可能、関連性があり、期限を定めることができる（SMART）ように記述されています。

## 2. 基本機能の受け入れ条件

### AC-001: テキストファイル変換

#### 前提条件
- 有効な独自記法を含むテキストファイル（.txt）が存在する
- Kumihan-Formatterがインストールされている

#### 実行条件
1. **コマンドライン実行**
   - `kumihan convert input.txt` を実行
   - 3秒以内に変換が開始される
   - 進捗表示が出力される

2. **ドラッグ&ドロップ実行**
   - バッチファイル/コマンドファイルを起動
   - テキストファイルをドラッグ&ドロップ
   - 自動的に変換が開始される

#### 期待結果
- distフォルダが作成される
- HTMLファイルが生成される
- ブラウザが自動的に開いて結果を表示する
- エラーが発生した場合、日本語でエラーメッセージが表示される

### AC-002: 記法の基本処理

#### 装飾記法
```
入力: #太字#
テスト
##
期待: <strong>テスト</strong>

入力: #枠線#
重要情報
##
期待: <div class="box-border">重要情報</div>

入力: #ハイライト color=#ffe6e6#
警告
##
期待: <mark style="background-color: #ffe6e6">警告</mark>
```

**注記**: α-dev仕様により、全記法がブロック形式で`##`終了マーカー必須。

#### 見出し記法
```
入力: #見出し1#
第1章
##
期待: <h1>第1章</h1>

入力: #見出し2#
1.1 概要
##
期待: <h2>1.1 概要</h2>
```

#### 複合記法
```
入力: #太字+枠線#
最重要
##
期待: <div class="box-border"><strong>最重要</strong></div>

入力: #見出し3+ハイライト color=#e1f5fe#
補足情報
##
期待: <h3 style="background-color: #e1f5fe">補足情報</h3>
```

**注記**: 複合記法は将来バージョンで実装予定（MVP対象外）。

### AC-003: 特殊記法の処理

#### 脚注記法
```
入力: これは本文です((補足説明))。
期待: 
- 本文: これは本文です<sup>[1]</sup>。
- 文末: <div class="footnotes">[1] 補足説明</div>
```

#### ルビ記法
```
入力: #ルビ 邪神(クトゥルフ)#の呼び声
期待: <ruby>邪神<rt>クトゥルフ</rt></ruby>の呼び声
```

#### ネタバレ記法
```
入力: #ネタバレ# 犯人は執事 #
期待: <details class="spoiler"><summary>ネタバレ注意</summary>犯人は執事</details>
```

### AC-004: リスト処理

#### 基本リスト
```
入力:
- 項目1
- 項目2
- 項目3

期待:
<ul>
  <li>項目1</li>
  <li>項目2</li>
  <li>項目3</li>
</ul>
```

#### 番号付きリスト
```
入力:
1. 手順1
2. 手順2
3. 手順3

期待:
<ol>
  <li>手順1</li>
  <li>手順2</li>
  <li>手順3</li>
</ol>
```

## 3. 高度な機能の受け入れ条件

### AC-005: 目次自動生成

#### 前提条件
- 文書内に#目次#記法が存在する
- 文書内に見出し（見出し1〜5）が存在する

#### 期待結果
```
入力:
#目次#
#見出し1# 第1章 #
#見出し2# 1.1 概要 #
#見出し2# 1.2 詳細 #

期待:
<nav class="toc">
  <ul>
    <li><a href="#heading-1">第1章</a>
      <ul>
        <li><a href="#heading-2">1.1 概要</a></li>
        <li><a href="#heading-3">1.2 詳細</a></li>
      </ul>
    </li>
  </ul>
</nav>
```

### AC-006: 画像処理

#### 基本的な画像埋め込み
```
入力: #画像# test.jpg #
期待: <img src="images/test.jpg"#### 画像ファイルの配置
- 入力ファイルと同じディレクトリのimagesフォルダから画像を検索
- 画像が存在しない場合、警告メッセージを表示（変換は継続）

### AC-007: エラーハンドリング

#### 構文エラー
```
入力: #太字 内容 #  （閉じマーカーなし）
期待: 
- エラーメッセージ: "構文エラー: 3行目 - ブロックが##で閉じられていません"
- 変換は中断される
```

#### ファイルエラー
```
入力: 存在しないファイル.txt
期待:
- エラーメッセージ: "エラー: ファイル '存在しないファイル.txt' が見つかりません"
```

#### エンコーディングエラー
```
入力: Shift-JISエンコードのファイル
期待:
- エラーメッセージ: "エラー: ファイルのエンコーディングがUTF-8ではありません"
- 対処法の提示: "UTF-8で保存し直してください"
```

## 4. 非機能要件の受け入れ条件

### AC-008: パフォーマンス

#### 変換速度
- 10ページ（約5,000文字）: 2秒以内
- 50ページ（約25,000文字）: 10秒以内
- 100ページ（約50,000文字）: 20秒以内

#### メモリ使用量
- 最大メモリ使用量: 500MB以下
- 通常使用時: 100MB以下

### AC-009: 互換性

#### OS互換性
- Windows 10以降: 完全動作
- macOS 12以降: 完全動作
- Ubuntu 20.04以降: 完全動作

#### ブラウザ互換性（生成されたHTML）
- Chrome/Edge: 最新版で完全表示
- Firefox: 最新版で完全表示
- Safari: 最新版で完全表示

### AC-010: ユーザビリティ

#### 初回使用
- インストール後、追加設定なしで使用可能
- サンプルファイルで5分以内に基本機能を理解可能

#### エラーメッセージ
- すべてのエラーメッセージが日本語
- 具体的な解決方法を提示
- エラー発生箇所を明確に表示

## 5. 配布機能の受け入れ条件

### AC-011: HTML出力

#### ファイル構造
```
dist/
├── index.html      # メインHTML
├── style.css       # スタイルシート（インライン化も可）
└── images/         # 画像フォルダ
    ├── image1.jpg
    └── image2.png
```

#### HTML品質
- W3C HTML5準拠
- アクセシビリティ: WCAG 2.1 レベルAA準拠
- SEO最適化: 適切なメタタグ設定

### AC-012: 印刷対応

#### A4印刷
- 余白: 上下左右20mm
- フォントサイズ: 本文10.5pt以上
- 見出しの改ページ制御
- 画像の分割防止

## 6. 拡張機能の受け入れ条件

### AC-013: ファイル監視モード

#### 動作条件
```bash
kumihan convert input.txt --watch
```

#### 期待動作
- ファイル変更を100ms以内に検知
- 自動再変換が1秒以内に開始
- エラー発生時も監視継続
- Ctrl+Cで正常終了

### AC-014: テンプレート機能

#### テンプレート適用
```bash
kumihan convert input.txt --template trpg-scenario
```

#### 期待結果
- 指定テンプレートのスタイルが適用される
- カスタムCSSが読み込まれる
- レイアウトが変更される

## 7. テスト手順

### 単体テスト
1. 各記法の個別テスト
2. エラーケースのテスト
3. 境界値テスト

### 統合テスト
1. 複数記法の組み合わせテスト
2. 大規模ファイルのテスト
3. 実際のTRPGシナリオでのテスト

### 受け入れテスト
1. ユーザーストーリーに基づくシナリオテスト
2. 非技術者によるユーザビリティテスト
3. 配布形式での動作確認

## 8. 品質基準

### コード品質
- テストカバレッジ: 80%以上
- 静的解析: エラー0件
- 型チェック: mypy strictモード通過

### ドキュメント品質
- すべての機能が文書化されている
- サンプルコードが動作する
- FAQ・トラブルシューティング完備

## 9. 改訂履歴

| バージョン | 日付 | 変更内容 | 作成者 |
|------------|------|----------|--------|
| 1.0.0 | 2025-01-29 | 初版作成 | Claude Code |