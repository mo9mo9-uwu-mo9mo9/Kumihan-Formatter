# Kumihan記法仕様書

## 1. 概要

このドキュメントは、Kumihan-FormatterのKumihan記法の完全な仕様を定義します。Kumihan記法は、非技術者でも簡単に美しい文書を作成できる独自のマークアップ記法です。

### 1.1 設計思想

- **直感性**: 見た目で内容が予想できる記法
- **簡潔性**: 最小限の記号で最大の表現力
- **一貫性**: 統一されたルールで覚えやすい
- **日本語適性**: 日本語文書作成に最適化

### 1.2 対象ユーザー

- TRPGシナリオ作成者
- 技術知識を持たない文書作成者
- 美しい文書レイアウトを必要とする一般ユーザー

## 2. 基本記法

### 2.1 基本構文

Kumihan記法のコア構文は以下の形式です：

```
;;;キーワード;;; 内容
```

**構成要素**:
- `;;;`: 開始マーカー（セミコロン3個）
- `キーワード`: 装飾や機能を指定
- `;;;`: 終了マーカー（セミコロン3個）
- ` `: 半角スペース1個（必須）
- `内容`: 実際のテキスト内容

### 2.2 処理ルール

#### 単行処理
```
;;;太字;;; 重要な情報です
```
**結果**: 1行で完結する内容

#### 複数行処理
```
;;;枠線;;;
NPC詳細情報：
- 名前：田中一郎
- 職業：私立探偵
- 特徴：鋭い観察眼

次の段落から通常テキスト
```
**ルール**:
- `;;;キーワード;;;` の次の行から空行まで継続
- 空行で終了
- インデントは保持される

## 3. コアキーワード仕様

### 3.1 装飾系キーワード

#### 太字
```
;;;太字;;; 強調したいテキスト
```
**HTML出力**: `<strong>強調したいテキスト</strong>`
**用途**: 重要な情報の強調

#### イタリック  
```
;;;イタリック;;; 引用や心の声
```
**HTML出力**: `<em>引用や心の声</em>`
**用途**: 引用文、心の声、雰囲気のある文章

#### 枠線
```
;;;枠線;;; 
重要な情報をまとめます
複数行での使用が一般的です
```
**HTML出力**: `<div class="box-border">内容</div>`
**用途**: 情報のまとめ、重要なデータの区別

#### ハイライト
```
;;;ハイライト;;; 背景色付きの強調

;;;ハイライト color=#ffe6e6;;; 赤系の背景色
;;;ハイライト color=#e6ffe6;;; 緑系の背景色
```
**HTML出力**: `<mark style="background-color: #色コード">内容</mark>`
**属性**:
- `color=#色コード`: 6桁の16進数カラーコード
**推奨カラーパレット**:
- 危険・警告: `#ffe6e6` (赤系)
- 安全・成功: `#e6ffe6` (緑系)  
- 注意・ヒント: `#fff3cd` (黄系)
- 情報・補足: `#e1f5fe` (青系)

### 3.2 構造系キーワード

#### 見出し1〜5
```
;;;見出し1;;; 文書タイトル
;;;見出し2;;; 第1章　大項目
;;;見出し3;;; 1.1 中項目
;;;見出し4;;; 詳細説明
;;;見出し5;;; 補足情報
```
**HTML出力**: `<h1>〜<h5>`タグ
**特徴**:
- 自動的にIDが付与される（アンカーリンク対応）
- 目次生成の対象となる

#### 目次
```
;;;目次;;;
```
**機能**: 文書内の見出し（見出し1〜5）から自動的に目次を生成
**HTML出力**: `<nav class="toc"><ul>...</ul></nav>`
**階層**: 見出しレベルに応じて入れ子構造

### 3.3 機能系キーワード

#### 折りたたみ
```
;;;折りたたみ;;;
詳細な情報：
この内容はデフォルトで非表示になり、
クリックで展開できます。
```
**HTML出力**: `<details><summary>クリックして展開</summary>内容</details>`
**用途**: 詳細情報の格納、ページの見やすさ向上

#### ネタバレ
```
;;;ネタバレ;;;
重要な真相や結末
GMが管理すべき秘密情報
```
**HTML出力**: `<details class="spoiler"><summary>ネタバレ注意</summary>内容</details>`
**用途**: TRPG用GM専用情報、小説の結末など

#### 画像
```
;;;画像;;; image.jpg
;;;画像 alt=説明文;;; image.png
```
**HTML出力**: `<img src="images/image.jpg" alt="説明文">`
**属性**:
- `alt=説明文`: 代替テキスト（アクセシビリティ対応）
**ファイル配置**: 入力ファイルと同じディレクトリの`images/`フォルダ

## 4. 複合記法

### 4.1 基本ルール

複数のキーワードを組み合わせて使用できます：

```
;;;キーワード1+キーワード2;;; 内容
;;;キーワード1＋キーワード2;;; 内容  (全角プラスも可)
```

### 4.2 組み合わせ例

#### 装飾の組み合わせ
```
;;;太字+枠線;;; 最重要情報
;;;太字+イタリック;;; 強調された引用文
;;;枠線+ハイライト color=#fff3cd;;; 注意事項ボックス
```

#### 見出しとの組み合わせ
```
;;;見出し2+太字;;; 第2章：重要な章
;;;見出し3+ハイライト color=#e1f5fe;;; 1.2 補足情報
```

### 4.3 組み合わせ制限

**禁止されている組み合わせ**:
- 見出し同士: `;;;見出し1+見出し2;;;` (エラー)
- 機能系同士: `;;;折りたたみ+ネタバレ;;;` (エラー)

**推奨されない組み合わせ**:
- 過度な装飾: 3個以上のキーワード組み合わせ

## 5. リスト記法

### 5.1 箇条書きリスト（ハイフン）
```
- 項目1
- 項目2
- 項目3
```
**HTML出力**: `<ul><li>項目1</li>...</ul>`

### 5.2 箇条書きリスト（中黒）
```
・項目1
・項目2  
・項目3
```
**HTML出力**: `<ul><li>項目1</li>...</ul>`

### 5.3 番号付きリスト
```
1. 手順1
2. 手順2
3. 手順3
```
**HTML出力**: `<ol><li>手順1</li>...</ol>`

### 5.4 リスト内での記法使用
```
- ;;;太字;;; 重要な項目
- ;;;ハイライト color=#ffe6e6;;; 危険な項目
・;;;イタリック;;; 補足項目
```

## 6. 段落と改行

### 6.1 段落の作成
```
これは最初の段落です。
同じ段落内では改行タグ<br>が挿入されます。

空行を入れると新しい段落になります。
段落間には適度な余白が入ります。
```

### 6.2 改行処理ルール

| 入力 | 出力 | 説明 |
|------|------|------|
| 1行のテキスト | そのまま1行 | 基本処理 |
| 改行 | `<br>`タグ | 段落内改行 |
| 空行 | 段落区切り `<p>` | 新しい段落 |

## 7. エラーパターンと対処法

### 7.1 よくあるエラー

#### 構文エラー
```
❌ ;;太字;; 内容          → セミコロン不足
✅ ;;;太字;;; 内容

❌ ;;;太字 内容          → 閉じマーカーなし  
✅ ;;;太字;;; 内容

❌ ;;;太字;;;内容        → スペースなし
✅ ;;;太字;;; 内容
```

#### キーワードエラー
```
❌ ;;;太文字;;; 内容     → 無効なキーワード
✅ ;;;太字;;; 内容

❌ ;;;bold;;; 内容       → 英語キーワード使用不可
✅ ;;;太字;;; 内容
```

### 7.2 エラーメッセージ例

**構文エラー**:
```
エラー: 3行目 - ブロックが;;;で閉じられていません
修正方法: ;;;太字;;; の後に ;;; を追加してください
```

**キーワードエラー**:
```
エラー: 5行目 - 無効なキーワード「太文字」が使用されています
正しいキーワード: 太字
有効なキーワード一覧: 太字, イタリック, 枠線, ハイライト...
```

## 8. 実装上の注意事項

### 8.1 パーサー要件
- UTF-8エンコーディング必須
- 半角・全角の区別なし（`+`と`＋`両対応）
- 大文字・小文字の区別なし（将来的な英語対応）

### 8.2 HTML出力要件
- W3C HTML5準拠
- アクセシビリティ対応（alt属性、適切なタグ使用）
- CSSクラス名の一貫性

### 8.3 互換性
- 既存のMarkdown記法との混在は非推奨
- HTMLタグの直接記述は非推奨

## 9. 将来的な拡張

### 9.1 検討中の機能
- テーブル記法
- 数式記法
- コードブロック記法
- 注釈機能の拡張

### 9.2 特殊記法（後日実装予定）
- 脚注記法: `((内容))`
- ルビ記法: `｜内容《読み》`

## 10. バージョン管理

### 10.1 記法バージョン
- **Current**: v1.0.0-alpha
- **Target**: v1.0.0 (正式リリース時)

### 10.2 後方互換性
- α版期間中: 破壊的変更あり
- β版以降: 重大な変更のみ
- v1.0.0以降: 厳格な後方互換性維持

## 11. 改訂履歴

| バージョン | 日付 | 変更内容 | 作成者 |
|------------|------|----------|--------|
| 1.0.0-alpha | 2025-01-29 | 初版作成、コロン記法採用 | Claude Code |