# エラーメッセージ仕様書

## 1. 概要

このドキュメントは、Kumihan-Formatterのエラーメッセージの仕様を定義します。全てのエラーメッセージは日本語で提供され、非技術者でも理解しやすい表現を使用します。

### 1.1 基本方針

- **分かりやすい日本語**: 専門用語を避け、具体的な説明
- **具体的な修正方法**: エラーの解決策を明示
- **エラー箇所の特定**: 行番号と問題のある内容を表示
- **建設的なトーン**: 責めるのではなく、解決を支援

## 2. エラーカテゴリ

### 2.1 構文エラー（Syntax Errors）
記法の基本的な書き方に関するエラー

### 2.2 キーワードエラー（Keyword Errors）
無効なキーワードや存在しないキーワードに関するエラー

### 2.3 ファイルエラー（File Errors）
ファイルの読み込みやエンコーディングに関するエラー

### 2.4 構造エラー（Structure Errors）
文書の論理的構造に関するエラー

### 2.5 属性エラー（Attribute Errors）
キーワードの属性（color、altなど）に関するエラー

## 3. 構文エラー

### 3.1 セミコロン不足エラー

**パターン**: `;;キーワード;;`

**エラーメッセージ**:
```
エラー: 3行目 - セミコロンが不足しています
問題のある記法: ;;太字;;
正しい記法: ;;;太字;;;
修正方法: セミコロン（;）を3個ずつ使用してください
```

**コード例**:
```python
def create_semicolon_error(line_num: int, content: str, keyword: str) -> str:
    return f"""エラー: {line_num}行目 - セミコロンが不足しています
問題のある記法: {content}
正しい記法: ;;;{keyword};;;
修正方法: セミコロン（;）を3個ずつ使用してください"""
```

### 3.2 閉じマーカー不足エラー

**パターン**: `;;;キーワード`

**エラーメッセージ**:
```
エラー: 5行目 - ブロックが正しく閉じられていません
問題のある記法: ;;;太字
正しい記法: ;;;太字;;; 内容
修正方法: キーワードの後に ;;; を追加してください
```

### 3.3 スペース不足エラー

**パターン**: `;;;キーワード;;;内容`

**エラーメッセージ**:
```
エラー: 7行目 - キーワードと内容の間にスペースがありません
問題のある記法: ;;;太字;;;重要な情報
正しい記法: ;;;太字;;; 重要な情報
修正方法: ;;; の後に半角スペースを1個入れてください
```

### 3.4 複数キーワードの誤用エラー

**パターン**: `;;;太字;;; ;;;枠線;;; 内容`

**エラーメッセージ**:
```
エラー: 9行目 - 複数のキーワードが正しく組み合わされていません
問題のある記法: ;;;太字;;; ;;;枠線;;; 内容
正しい記法: ;;;太字+枠線;;; 内容
修正方法: キーワードを+記号で連結してください
```

## 4. キーワードエラー

### 4.1 無効なキーワードエラー

**パターン**: `;;;太文字;;; 内容`

**エラーメッセージ**:
```
エラー: 11行目 - 無効なキーワード「太文字」が使用されています
正しいキーワード: 太字
類似のキーワード: 太字, 枠線
利用可能なキーワード一覧:
  装飾系: 太字, イタリック, 枠線, ハイライト
  構造系: 見出し1, 見出し2, 見出し3, 見出し4, 見出し5, 目次
  機能系: 折りたたみ, ネタバレ, 画像
```

### 4.2 英語キーワードエラー

**パターン**: `;;;bold;;; 内容`

**エラーメッセージ**:
```
エラー: 13行目 - 英語のキーワード「bold」は使用できません
日本語のキーワード: 太字
修正方法: 日本語のキーワードを使用してください
```

### 4.3 キーワード大文字小文字エラー

**パターン**: `;;;タイジ;;; 内容`

**エラーメッセージ**:
```
エラー: 15行目 - キーワード「タイジ」が見つかりません
推測される正しいキーワード: 太字
修正方法: ひらがなで「太字」と入力してください
```

## 5. 複合記法エラー

### 5.1 禁止された組み合わせエラー

**パターン**: `;;;見出し1+見出し2;;; 内容`

**エラーメッセージ**:
```
エラー: 17行目 - 見出し同士の組み合わせは使用できません
問題のある記法: ;;;見出し1+見出し2;;;
理由: 見出しは1つのレベルのみ指定可能です
修正方法: 見出し1または見出し2のどちらか一方を使用してください
```

### 5.2 機能系の重複エラー

**パターン**: `;;;折りたたみ+ネタバレ;;; 内容`

**エラーメッセージ**:
```
エラー: 19行目 - 機能系キーワードの組み合わせは使用できません
問題のある記法: ;;;折りたたみ+ネタバレ;;;
理由: 折りたたみとネタバレは同時に使用できません
修正方法: 折りたたみまたはネタバレのどちらか一方を使用してください
```

### 5.3 過度な組み合わせ警告

**パターン**: `;;;太字+イタリック+枠線+ハイライト;;; 内容`

**警告メッセージ**:
```
警告: 21行目 - キーワードの組み合わせが多すぎます（4個）
推奨: 組み合わせは2-3個以内にしてください
理由: 読みやすさと美しさを保つため
現在の記法: ;;;太字+イタリック+枠線+ハイライト;;;
```

## 6. 属性エラー

### 6.1 カラーコード形式エラー

**パターン**: `;;;ハイライト color=red;;; 内容`

**エラーメッセージ**:
```
エラー: 23行目 - カラーコードの形式が正しくありません
問題のある形式: color=red
正しい形式: color=#ff0000
修正方法: #記号に続けて6桁の16進数を入力してください
例: #ff0000（赤）, #00ff00（緑）, #0000ff（青）
```

### 6.2 サポートされていない属性エラー

**パターン**: `;;;太字 color=#ff0000;;; 内容`

**エラーメッセージ**:
```
エラー: 25行目 - キーワード「太字」はcolor属性をサポートしていません
サポートされるキーワード: ハイライト
修正方法: ハイライトキーワードを使用するか、color属性を削除してください
例: ;;;ハイライト color=#ff0000;;; 内容
```

### 6.3 必須属性不足エラー

**パターン**: `;;;画像;;; （ファイル名なし）`

**エラーメッセージ**:
```
エラー: 27行目 - 画像のファイル名が指定されていません
正しい記法: ;;;画像;;; ファイル名.jpg
または: ;;;画像 alt=説明;;; ファイル名.jpg
修正方法: 画像ファイルの名前を指定してください
```

## 7. ファイルエラー

### 7.1 ファイル不存在エラー

**エラーメッセージ**:
```
エラー: ファイル「scenario.txt」が見つかりません
確認事項:
1. ファイル名の綴りを確認してください
2. ファイルが正しいディレクトリにあるか確認してください
3. ファイルの拡張子（.txt）を確認してください
現在のディレクトリ: /Users/username/Documents
```

### 7.2 エンコーディングエラー

**エラーメッセージ**:
```
エラー: ファイル「scenario.txt」のエンコーディングがUTF-8ではありません
検出されたエンコーディング: Shift-JIS
修正方法:
1. テキストエディタでファイルを開く
2. 「名前を付けて保存」を選択
3. 文字エンコーディングを「UTF-8」に変更
4. 保存してから再実行してください
```

### 7.3 ファイル読み込み権限エラー

**エラーメッセージ**:
```
エラー: ファイル「scenario.txt」の読み込み権限がありません
修正方法:
1. ファイルのプロパティ（右クリック→プロパティ）を開く
2. セキュリティタブで読み取り権限を確認
3. 必要に応じて権限を変更してください
```

## 8. 画像関連エラー

### 8.1 画像ファイル不存在エラー

**エラーメッセージ**:
```
警告: 29行目 - 画像ファイル「map.jpg」が見つかりません
探索場所: images/map.jpg
確認事項:
1. imagesフォルダが存在するか確認
2. ファイル名の綴りを確認（大文字小文字を含む）
3. ファイル形式（.jpg, .png, .gif）を確認
対処: 変換は続行されますが、画像は表示されません
```

### 8.2 サポートされていない画像形式エラー

**エラーメッセージ**:
```
警告: 31行目 - 画像形式「.bmp」はサポートされていません
指定されたファイル: image.bmp
サポートされる形式: .jpg, .jpeg, .png, .gif, .webp
修正方法: 画像を対応形式に変換してください
```

## 9. 構造エラー

### 9.1 目次位置エラー

**エラーメッセージ**:
```
警告: 33行目 - 目次の後に見出しがありません
目次は見出し（見出し1〜5）の前に配置することをお勧めします
現在の構造: 目次 → 通常テキスト
推奨の構造: 目次 → 見出し1 → 内容
```

### 9.2 見出し階層エラー

**エラーメッセージ**:
```
警告: 35行目 - 見出しの階層が適切ではありません
現在: 見出し1 → 見出し3（見出し2をスキップ）
推奨: 見出し1 → 見出し2 → 見出し3
理由: 読者にとって理解しやすい構造にするため
```

## 10. エラーメッセージの国際化対応

### 10.1 将来的な英語対応

```python
class ErrorMessages:
    def __init__(self, language="ja"):
        self.language = language
    
    def syntax_error(self, line_num: int, content: str) -> str:
        if self.language == "ja":
            return f"エラー: {line_num}行目 - 構文エラーです"
        else:
            return f"Error: Line {line_num} - Syntax error"
```

## 11. エラーログ形式

### 11.1 詳細ログ形式

```
[2025-01-29 14:30:15] ERROR - Syntax Error
File: scenario.txt
Line: 15
Column: 8
Content: ;;太字;; 重要な情報
Error Type: INSUFFICIENT_SEMICOLONS
User Message: エラー: 15行目 - セミコロンが不足しています...
Suggestion: ;;;太字;;;
```

### 11.2 サマリーログ形式

```
変換結果サマリー:
- 処理ファイル: scenario.txt
- 総行数: 150行
- エラー: 3件
- 警告: 2件
- 変換時間: 1.2秒
- 出力ファイル: dist/scenario.html

詳細は logs/kumihan.log を確認してください
```

## 12. エラー回復戦略

### 12.1 継続可能なエラー
- 画像ファイル不存在 → 警告表示して変換継続
- 無効なカラーコード → デフォルト色使用して継続
- 見出し階層不整合 → 警告表示して継続

### 12.2 致命的なエラー
- ファイル読み込み不可 → 変換中止
- 重大な構文エラー → 変換中止
- エンコーディング不一致 → 変換中止

## 13. ユーザー体験の改善

### 13.1 エラー発生時の支援

**段階的なヘルプ提供**:
1. 基本的なエラーメッセージ
2. 具体的な修正方法
3. 関連ドキュメントへのリンク
4. よくある質問（FAQ）への案内

### 13.2 学習支援

**初心者向け機能**:
- エラーパターンから学習リソースを提案
- 正しい記法のサンプル提示
- インタラクティブなチュートリアル案内

## 14. 改訂履歴

| バージョン | 日付 | 変更内容 | 作成者 |
|------------|------|----------|--------|
| 1.0.0-alpha | 2025-01-29 | 初版作成、新記法対応 | Claude Code |