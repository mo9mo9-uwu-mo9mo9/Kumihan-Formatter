{
  "_comment": "MCP Configuration Template - Serena最適化設定継承版",
  "_template_info": {
    "version": "2.0.0",
    "optimization_source": "Kumihan-Formatter Issue #803/#804",
    "token_reduction_effect": "66.8%",
    "generation_date": "{GENERATION_DATE}",
    "setup_instructions": [
      "1. {SERENA_PATH} をSerenaインストールパスに置換",
      "2. オプション: context7, gemini-cli を必要に応じて有効/無効化",
      "3. Serena接続確認: claude mcp test serena",
      "4. 最適化効果確認: Serena使用時の応答速度・トークン削減効果"
    ]
  },
  "mcpServers": {
    "serena": {
      "_description": "Serena Expert Agent - Issue #803最適化基盤",
      "_optimization_level": "phase_b2_complete",
      "_expected_benefits": [
        "66.8%トークン削減効果",
        "動的設定調整",
        "パターン学習機能",
        "A/Bテスト統合",
        "リアルタイム監視"
      ],
      "type": "stdio",
      "command": "uv",
      "args": [
        "run",
        "--directory",
        "{SERENA_PATH}",
        "serena-mcp-server"
      ],
      "env": {
        "_comment": "Serena最適化環境変数設定",
        "SERENA_OPTIMIZATION_LEVEL": "phase_b2",
        "SERENA_TOKEN_OPTIMIZATION": "enabled",
        "SERENA_LEARNING_MODE": "adaptive",
        "SERENA_MONITORING_LEVEL": "detailed"
      }
    },
    "context7": {
      "_description": "Context7 Documentation Server - AI最適化対応",
      "_optimization_notes": "Issue #803最適化により高速ドキュメント検索",
      "type": "stdio",
      "command": "npx",
      "args": [
        "-y",
        "@upstash/context7-mcp"
      ],
      "env": {
        "_comment": "Context7最適化設定",
        "CONTEXT7_OPTIMIZATION": "enabled",
        "CONTEXT7_CACHE_STRATEGY": "aggressive"
      }
    },
    "gemini-cli": {
      "_description": "Gemini CLI Integration - AI分析最適化",
      "_optimization_features": [
        "高速レスポンス",
        "トークン効率化",
        "並列処理最適化"
      ],
      "type": "stdio",
      "command": "npx",
      "args": [
        "mcp-gemini-cli",
        "--allow-npx",
        "--optimization-mode",
        "high-efficiency"
      ],
      "env": {
        "_comment": "Gemini最適化環境設定",
        "GEMINI_OPTIMIZATION": "enabled",
        "GEMINI_RESPONSE_OPTIMIZATION": "phase_b2",
        "GEMINI_TOKEN_EFFICIENCY": "maximum"
      }
    }
  },
  "_optimization_settings": {
    "_description": "Issue #803/#804最適化設定メタデータ",
    "optimization_metadata": {
      "phase_implemented": "Phase B.2 Complete",
      "token_reduction_achieved": "66.8%",
      "baseline_tokens": 200000,
      "optimized_tokens": 80000,
      "key_optimizations": [
        "動的max_answer_chars調整",
        "コンテキスト別最適化",
        "パターン学習システム",
        "A/Bテスト統合",
        "リアルタイム効率監視"
      ]
    },
    "performance_expectations": {
      "response_time_improvement": "40-60% faster",
      "memory_usage_reduction": "30-50% less",
      "accuracy_maintained": "95%+ preserved",
      "stability_rating": "production-ready"
    },
    "compatibility_info": {
      "serena_version_min": "0.8.0",
      "python_version_min": "3.10",
      "node_version_min": "18.0",
      "os_support": ["macOS", "Linux", "Windows"]
    }
  },
  "_monitoring_integration": {
    "_description": "Serena最適化効果監視設定",
    "monitoring_servers": {
      "serena-monitor": {
        "_description": "Serena効果リアルタイム監視（オプション）",
        "_activation": "manual",
        "type": "stdio",
        "command": "uv",
        "args": [
          "run",
          "--directory",
          "{SERENA_PATH}",
          "serena-monitor",
          "--optimization-tracking",
          "--token-efficiency-mode"
        ],
        "env": {
          "SERENA_MONITOR_MODE": "optimization",
          "SERENA_TRACK_EFFICIENCY": "true",
          "SERENA_LOG_LEVEL": "WARNING"
        }
      }
    }
  },
  "_future_ai_integration": {
    "_description": "Phase B.4 AI駆動型最適化準備設定",
    "_status": "prepared_but_disabled",
    "ai_servers_prepared": {
      "serena-ai-optimizer": {
        "_description": "AI駆動型最適化エンジン（Phase B.4用）",
        "_implementation_status": "template_ready",
        "_activation_condition": "phase_b4_implementation",
        "type": "stdio",
        "command": "uv",
        "args": [
          "run",
          "--directory",
          "{SERENA_PATH}",
          "serena-ai-optimizer",
          "--ml-optimization",
          "--prediction-engine",
          "--autonomous-control"
        ],
        "env": {
          "SERENA_AI_MODE": "enabled",
          "SERENA_ML_OPTIMIZATION": "true",
          "SERENA_PREDICTION_ENGINE": "lightgbm",
          "SERENA_LEARNING_SYSTEM": "online"
        }
      }
    },
    "_expected_future_benefits": [
      "74-78%削減効果（Phase B.4実装時）",
      "予測的最適化",
      "自律制御システム",
      "継続学習機能",
      "異常検出・自己修復"
    ]
  },
  "_troubleshooting": {
    "_description": "トラブルシューティング情報",
    "common_issues": {
      "serena_connection_failed": {
        "symptoms": ["SerenaサーバーがmcpServersリストに表示されない"],
        "solutions": [
          "Serenaインストール確認: uv --version",
          "パス確認: {SERENA_PATH} が正しく設定されているか",
          "権限確認: ディレクトリアクセス権限",
          "MCP再起動: Claude Code完全再起動"
        ]
      },
      "optimization_not_working": {
        "symptoms": ["応答時間が改善されない", "トークン削減効果が見えない"],
        "solutions": [
          "Serena設定確認: .serena/project.yml の最適化設定",
          "環境変数確認: SERENA_OPTIMIZATION_LEVEL=phase_b2",
          "監視ツール実行: serena-monitor --efficiency-check",
          "ベンチマーク実行: 最適化前後の比較測定"
        ]
      },
      "phase_b4_preparation": {
        "description": "将来のPhase B.4実装準備",
        "requirements": [
          "Python機械学習ライブラリ: scikit-learn, lightgbm, pandas",
          "追加リソース: CPU 2コア以上, メモリ 4GB以上",
          "データストレージ: 学習データ保存用に500MB以上"
        ]
      }
    }
  },
  "_template_usage": {
    "_description": "テンプレート使用手順",
    "setup_steps": [
      "1. {SERENA_PATH} を実際のSerenaインストールパスに置換",
      "2. {GENERATION_DATE} を現在日時に置換",
      "3. 不要なMCPサーバー（context7, gemini-cli等）を削除または無効化",
      "4. ファイル名を .mcp.json に変更",
      "5. Claude Code再起動",
      "6. serena接続テスト: claude mcp test serena",
      "7. 最適化効果確認: Serenaコマンド実行時の応答速度"
    ],
    "customization_options": {
      "minimal_setup": "serenaのみ有効化",
      "full_setup": "全MCPサーバー有効化",
      "development_setup": "監視ツール追加有効化",
      "production_setup": "安定性重視設定"
    }
  }
}
