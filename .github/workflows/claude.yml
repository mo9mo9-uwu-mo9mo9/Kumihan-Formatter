name: Claude Code Review

on:
  issue_comment:
    types: [created]

permissions:
  contents: write
  pull-requests: write
  issues: write

jobs:
  claude-review:
    if: contains(github.event.comment.body, '@claude')
    runs-on: ubuntu-latest
    
    steps:
      - name: Check if comment is on PR
        id: check
        run: |
          if [ -n "${{ github.event.issue.pull_request }}" ]; then
            echo "is_pr=true" >> $GITHUB_OUTPUT
          else
            echo "is_pr=false" >> $GITHUB_OUTPUT
          fi
          
      - name: Respond to mention
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const comment = context.payload.comment.body;
            const issue_number = context.issue.number;
            
            console.log(`Claude mention detected: ${comment}`);
            
            // å¿œç­”ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
            const response = `ğŸ¤– **Claude Code ãŒå‘¼ã³å‡ºã•ã‚Œã¾ã—ãŸ**
            
ãƒªã‚¯ã‚¨ã‚¹ãƒˆå—ä¿¡: 
\`\`\`
${comment}
\`\`\`

**æ³¨æ„**: ç¾åœ¨ã€Claude Codeçµ±åˆã¯å†æ§‹ç¯‰ä¸­ã§ã™ã€‚
å®Œå…¨ãªæ©Ÿèƒ½ã‚’åˆ©ç”¨ã™ã‚‹ã«ã¯ä»¥ä¸‹ãŒå¿…è¦ã§ã™ï¼š
1. Claude APIã®çµ±åˆè¨­å®š
2. é©åˆ‡ãªèªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã®è¨­å®š
3. ã‚³ãƒ¼ãƒ‰è§£ææ©Ÿèƒ½ã®å®Ÿè£…

ä¸€æ™‚çš„ãªå¿œç­”ã¨ã—ã¦ã€ã“ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿”ä¿¡ã—ã¦ã„ã¾ã™ã€‚

---
*GitHub Actions ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œ ID: ${context.runId}*`;
            
            // ã‚³ãƒ¡ãƒ³ãƒˆã‚’æŠ•ç¨¿
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: issue_number,
              body: response
            });
            
            console.log('Response posted successfully');