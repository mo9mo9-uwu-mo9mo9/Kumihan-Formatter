# Kumihan-Formatter Pre-commit Hooks
# Issue #371å¯¾å¿œ: æ®µéšçš„ãƒã‚§ãƒƒã‚¯ä½“åˆ¶
# å¿…é ˆãƒ•ãƒƒã‚¯ï¼ˆæ¯å›å®Ÿè¡Œï¼‰+ æ¨å¥¨ãƒ•ãƒƒã‚¯ï¼ˆCIæ™‚å®Ÿè¡Œï¼‰

repos:
  # æ¨™æº–çš„ãªå“è³ªãƒã‚§ãƒƒã‚¯
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.4.0
    hooks:
      - id: trailing-whitespace
      - id: end-of-file-fixer
      - id: check-yaml
      - id: check-added-large-files
        args: ['--maxkb=500']
      - id: check-merge-conflict

  # Python ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
  - repo: https://github.com/psf/black
    rev: 25.1.0
    hooks:
      - id: black
        language_version: python3
        args: [--line-length=88]

  # Importæ•´ç†ï¼ˆå¿…é ˆãƒ•ãƒƒã‚¯ï¼‰
  - repo: https://github.com/pycqa/isort
    rev: 6.0.1
    hooks:
      - id: isort
        args: [--profile=black, --line-length=88]

  # åŸºæœ¬çš„ãªæ§‹æ–‡ãƒã‚§ãƒƒã‚¯ï¼ˆå¿…é ˆãƒ•ãƒƒã‚¯ï¼‰
  - repo: https://github.com/pycqa/flake8
    rev: 6.0.0
    hooks:
      - id: flake8
        args: ['--max-line-length=127', '--select=E9,F63,F7,F82']
        files: ^(kumihan_formatter|tests)/.*\.py$

# --- è»½é‡åŒ–è¨­å®šï¼ˆIssue #371å¯¾å¿œï¼‰---
# ä»¥ä¸‹ã®ãƒ•ãƒƒã‚¯ã¯é‡ã„ãŸã‚ã€CIå®Ÿè¡Œæ™‚ã®ã¿æœ‰åŠ¹åŒ–
# ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºã§ã¯ `SKIP=heavy-checks pre-commit run` ã§é™¤å¤–å¯èƒ½

  # Kumihan-Formatter æ¨å¥¨ãƒã‚§ãƒƒã‚¯ï¼ˆé‡ã„ãƒ•ãƒƒã‚¯ï¼‰
  - repo: local
    hooks:
      # è»½é‡ãƒ†ã‚¹ãƒˆãƒã‚§ãƒƒã‚¯ï¼ˆå¿…é ˆãƒ•ãƒƒã‚¯ï¼‰
      - id: quick-test
        name: âš¡ è»½é‡ãƒ†ã‚¹ãƒˆãƒã‚§ãƒƒã‚¯
        entry: bash
        args: [-c, 'python -m pytest -x --ff -q tests/ || echo "âš ï¸ ãƒ†ã‚¹ãƒˆå¤±æ•—: è©³ç´°ã¯CIã§ç¢ºèªã—ã¦ãã ã•ã„"']
        language: system
        pass_filenames: false
        always_run: true
        stages: [commit]

      # ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£åŸå‰‡ãƒã‚§ãƒƒã‚¯ï¼ˆæ¨å¥¨ãƒ•ãƒƒã‚¯ï¼‰
      - id: architecture-validator
        name: ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£åŸå‰‡ãƒã‚§ãƒƒã‚¯
        entry: python dev/tools/architecture_validator.py --fail-on-error
        language: python
        files: ^kumihan_formatter/.*\.py$
        pass_filenames: false
        additional_dependencies: []
        stages: [manual, pre-push]
        alias: heavy-checks

      # ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºåˆ¶é™ãƒã‚§ãƒƒã‚¯ï¼ˆæ¨å¥¨ãƒ•ãƒƒã‚¯ï¼‰
      - id: file-size-limit
        name: ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºåˆ¶é™ãƒã‚§ãƒƒã‚¯ (300è¡Œ)
        entry: python dev/tools/check_file_size.py --max-lines=300 --warning-lines=240
        language: python
        files: ^kumihan_formatter/.*\.py$
        pass_filenames: false
        stages: [manual, pre-push]
        alias: heavy-checks

      # è¤‡é›‘åº¦ãƒã‚§ãƒƒã‚¯ï¼ˆæ¨å¥¨ãƒ•ãƒƒã‚¯ï¼‰
      - id: complexity-check
        name: ğŸ§  è¤‡é›‘åº¦ãƒã‚§ãƒƒã‚¯
        entry: python -m radon cc kumihan_formatter/ --min=B --show-complexity
        language: python
        files: ^kumihan_formatter/.*\.py$
        pass_filenames: false
        additional_dependencies: [radon]
        stages: [manual, pre-push]
        alias: heavy-checks

      # ãƒ•ãƒ«ãƒ†ã‚¹ãƒˆï¼ˆæ¨å¥¨ãƒ•ãƒƒã‚¯ï¼‰
      - id: full-test
        name: ğŸ§ª ãƒ•ãƒ«ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆ
        entry: python -m pytest --cov=kumihan_formatter --cov-report=term-missing
        language: python
        pass_filenames: false
        stages: [manual, pre-push]
        alias: heavy-checks

      # å‹ãƒã‚§ãƒƒã‚¯ï¼ˆstrict modeå¿…é ˆï¼‰
      - id: mypy-strict
        name: ğŸ” mypy strict modeå‹ãƒã‚§ãƒƒã‚¯
        entry: python
        args: [-m, mypy, --strict, kumihan_formatter/, tests/]
        language: python
        files: ^(kumihan_formatter|tests)/.*\.py$
        pass_filenames: false
        additional_dependencies: [mypy, pydantic]
        stages: [commit, manual, pre-push]
        always_run: true
