# Kumihan-Formatter Pre-commit Hooks
# Issue #371å¯¾å¿œ: æ®µéšçš„ãƒã‚§ãƒƒã‚¯ä½“åˆ¶
# å¿…é ˆãƒ•ãƒƒã‚¯ï¼ˆæ¯å›å®Ÿè¡Œï¼‰+ æ¨å¥¨ãƒ•ãƒƒã‚¯ï¼ˆCIæ™‚å®Ÿè¡Œï¼‰

repos:
  # æ¨™æº–çš„ãªå“è³ªãƒã‚§ãƒƒã‚¯
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.4.0
    hooks:
      - id: trailing-whitespace
      - id: end-of-file-fixer
      - id: check-yaml
      - id: check-added-large-files
        args: ['--maxkb=500']
      - id: check-merge-conflict

  # Python ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
  - repo: https://github.com/psf/black
    rev: 25.1.0
    hooks:
      - id: black
        language_version: python3
        args: [--line-length=88]

  # Importæ•´ç†ï¼ˆå¿…é ˆãƒ•ãƒƒã‚¯ï¼‰
  - repo: https://github.com/pycqa/isort
    rev: 6.0.1
    hooks:
      - id: isort
        args: [--profile=black, --line-length=88]

  # åŸºæœ¬çš„ãªæ§‹æ–‡ãƒã‚§ãƒƒã‚¯ï¼ˆå¿…é ˆãƒ•ãƒƒã‚¯ï¼‰
  - repo: https://github.com/pycqa/flake8
    rev: 6.0.0
    hooks:
      - id: flake8
        args: ['--max-line-length=127', '--select=E9,F63,F7,F82']
        files: ^kumihan_formatter/.*\.py$

# --- è»½é‡åŒ–è¨­å®šï¼ˆIssue #371å¯¾å¿œï¼‰---
# ä»¥ä¸‹ã®ãƒ•ãƒƒã‚¯ã¯é‡ã„ãŸã‚ã€CIå®Ÿè¡Œæ™‚ã®ã¿æœ‰åŠ¹åŒ–
# ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºã§ã¯ `SKIP=heavy-checks pre-commit run` ã§é™¤å¤–å¯èƒ½

  # Kumihan-Formatter æ¨å¥¨ãƒã‚§ãƒƒã‚¯ï¼ˆé‡ã„ãƒ•ãƒƒã‚¯ï¼‰
  - repo: local
    hooks:
      # è»½é‡ãƒ†ã‚¹ãƒˆãƒã‚§ãƒƒã‚¯ï¼ˆå¿…é ˆãƒ•ãƒƒã‚¯ï¼‰
      - id: quick-test
        name: âš¡ è»½é‡ãƒ†ã‚¹ãƒˆãƒã‚§ãƒƒã‚¯
        entry: bash
        args: [-c, 'python -m pytest tests/unit tests/integration -v --tb=short || echo "âš ï¸ ãƒ†ã‚¹ãƒˆå¤±æ•—: è©³ç´°ã¯CIã§ç¢ºèªã—ã¦ãã ã•ã„"']
        language: system
        pass_filenames: false
        always_run: true
        stages: [pre-commit]

      # ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºåˆ¶é™ãƒã‚§ãƒƒã‚¯ï¼ˆå¿…é ˆãƒ•ãƒƒã‚¯ - æŠ€è¡“çš„è² å‚µäºˆé˜²ï¼‰
      - id: file-size-check
        name: ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãƒã‚§ãƒƒã‚¯ (300è¡Œåˆ¶é™)
        entry: python scripts/check_file_size.py --max-lines=300
        language: python
        files: ^kumihan_formatter/.*\.py$
        pass_filenames: false
        stages: [pre-commit]

      # ãƒ•ã‚¡ã‚¤ãƒ«è‡ªå‹•åˆ†å‰²ï¼ˆå¿…é ˆãƒ•ãƒƒã‚¯ - 300è¡Œè¶…éæ™‚ã®è‡ªå‹•å¯¾å¿œï¼‰
      - id: auto-file-split
        name: âœ‚ï¸ ãƒ•ã‚¡ã‚¤ãƒ«è‡ªå‹•åˆ†å‰² (300è¡Œè¶…éæ™‚)
        entry: bash scripts/auto_split_files.sh
        language: system
        files: ^kumihan_formatter/.*\.py$
        pass_filenames: false
        stages: [pre-commit]

      # ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ«ãƒ¼ãƒ«ãƒã‚§ãƒƒã‚¯ï¼ˆæ¨å¥¨ãƒ•ãƒƒã‚¯ï¼‰
      - id: architecture-check
        name: ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ«ãƒ¼ãƒ«ãƒã‚§ãƒƒã‚¯
        entry: python scripts/architecture_check.py --target-dir=kumihan_formatter
        language: python
        files: ^kumihan_formatter/.*\.py$
        pass_filenames: false
        stages: [manual, pre-push]
        alias: heavy-checks

      # è¤‡é›‘åº¦ãƒã‚§ãƒƒã‚¯ï¼ˆæ¨å¥¨ãƒ•ãƒƒã‚¯ï¼‰
      - id: complexity-check
        name: ğŸ§  è¤‡é›‘åº¦ãƒã‚§ãƒƒã‚¯
        entry: python -m radon cc kumihan_formatter/ --min=B --show-complexity
        language: python
        files: ^kumihan_formatter/.*\.py$
        pass_filenames: false
        additional_dependencies: [radon]
        stages: [manual, pre-push]
        alias: heavy-checks

      # ãƒ•ãƒ«ãƒ†ã‚¹ãƒˆï¼ˆæ¨å¥¨ãƒ•ãƒƒã‚¯ï¼‰
      - id: full-test
        name: ğŸ§ª ãƒ•ãƒ«ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆ
        entry: python -m pytest --cov=kumihan_formatter --cov-report=term-missing
        language: python
        pass_filenames: false
        stages: [manual, pre-push]
        alias: heavy-checks

      # å‹ãƒã‚§ãƒƒã‚¯ï¼ˆIssue #497: è­¦å‘Šè¡¨ç¤ºã®ã¿ï¼‰
      - id: mypy-strict
        name: ğŸ” mypy strict modeå‹ãƒã‚§ãƒƒã‚¯ï¼ˆè­¦å‘Šã®ã¿ï¼‰
        entry: bash
        args: [-c, 'echo "âš ï¸ å‹ãƒã‚§ãƒƒã‚¯ï¼ˆIssue #497: è­¦å‘Šè¡¨ç¤ºã®ã¿ï¼‰" && python -m mypy --config-file=mypy.ini kumihan_formatter/ || echo "ğŸ” å‹ã‚¨ãƒ©ãƒ¼è­¦å‘Šã‚’æ¤œå‡ºï¼ˆPhase 2-4ã§æ®µéšçš„ä¿®æ­£äºˆå®šï¼‰"']
        language: system
        files: ^kumihan_formatter/.*\.py$
        pass_filenames: false
        stages: [pre-commit, manual, pre-push]
        always_run: true
        verbose: true
