<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }}</title>
    <style>
        /* æ—¢å­˜ã®base.html.j2ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ãƒ™ãƒ¼ã‚¹ã«ã€ãƒˆã‚°ãƒ«æ©Ÿèƒ½ç”¨ã‚¹ã‚¿ã‚¤ãƒ«ã‚’è¿½åŠ  */
        
        /* ãƒªã‚»ãƒƒãƒˆCSS */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ« */
        body {
            font-family: {% if css_vars.font_family %}"{{ css_vars.font_family }}"{% else %}"Hiragino Kaku Gothic ProN", "Hiragino Sans", "Yu Gothic", "Meiryo", sans-serif{% endif %};
            line-height: {% if css_vars.line_height %}{{ css_vars.line_height }}{% else %}1.8{% endif %};
            color: {% if css_vars.text_color %}{{ css_vars.text_color }}{% else %}#333{% endif %};
            background-color: {% if css_vars.background_color %}{{ css_vars.background_color }}{% else %}#f9f9f9{% endif %};
            padding: 20px;
        }

        /* ========== æ–°æ©Ÿèƒ½: ã‚½ãƒ¼ã‚¹ãƒ»çµæœãƒˆã‚°ãƒ« ========== */
        
        /* ãƒˆã‚°ãƒ«ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« */
        .source-result-controls {
            background: white;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .control-row {
            margin-bottom: 15px;
        }
        
        .control-row:last-child {
            margin-bottom: 0;
        }
        
        .toggle-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .toggle-btn {
            padding: 12px 24px;
            border: 2px solid #ddd;
            background: white;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            min-width: 120px;
        }
        
        .toggle-btn:hover {
            background: #f8f9fa;
            border-color: #007bff;
        }
        
        .toggle-btn.active {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }
        
        .sync-toggle-btn {
            padding: 8px 16px;
            border: 2px solid #28a745;
            background: #28a745;
            color: white;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.3s ease;
            margin-top: 10px;
        }
        
        .sync-toggle-btn:hover {
            background: #218838;
            border-color: #218838;
        }
        
        /* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚³ãƒ³ãƒ†ãƒŠ */
        .content-wrapper {
            display: grid;
            gap: 20px;
            max-width: 100%;
        }
        
        /* ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—: æ¨ªä¸¦ã³è¡¨ç¤º */
        @media (min-width: 768px) {
            .content-wrapper.side-by-side {
                grid-template-columns: 1fr 1fr;
            }
            
            .toggle-buttons {
                display: none; /* ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã§ã¯å¸¸ã«ä¸¡æ–¹è¡¨ç¤º */
            }
            
            .source-result-controls {
                text-align: center;
                background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            }
            
            .controls-title {
                font-size: 18px;
                font-weight: bold;
                color: #495057;
                margin: 0;
            }
            
            .controls-subtitle {
                font-size: 14px;
                color: #6c757d;
                margin-top: 5px;
            }
            
            .desktop-only {
                display: block;
            }
        }
        
        /* ãƒ¢ãƒã‚¤ãƒ«: åˆ‡ã‚Šæ›¿ãˆè¡¨ç¤º */
        @media (max-width: 767px) {
            .content-wrapper {
                grid-template-columns: 1fr;
            }
            
            .source-view.mobile-hidden,
            .result-view.mobile-hidden {
                display: none;
            }
            
            .controls-title {
                font-size: 16px;
                font-weight: bold;
                color: #495057;
                margin-bottom: 15px;
            }
            
            .desktop-only {
                display: none; /* ãƒ¢ãƒã‚¤ãƒ«ã§ã¯éè¡¨ç¤º */
            }
        }
        
        /* ã‚½ãƒ¼ã‚¹ãƒ“ãƒ¥ãƒ¼ */
        .source-view {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .source-header {
            background: linear-gradient(135deg, #343a40 0%, #495057 100%);
            color: white;
            padding: 12px 20px;
            font-weight: 600;
            font-size: 14px;
        }
        
        .source-content {
            background: #f8f9fa;
            padding: 20px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.6;
            overflow-x: auto;
            white-space: pre-wrap;
            color: #212529;
            border: none;
            max-height: 70vh;
            overflow-y: auto;
        }
        
        /* çµæœãƒ“ãƒ¥ãƒ¼ */
        .result-view {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .result-header {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
            padding: 12px 20px;
            font-weight: 600;
            font-size: 14px;
        }
        
        .result-content {
            padding: 20px;
            max-height: 70vh;
            overflow-y: auto;
        }
        
        /* ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆ */
        .source-content .keyword {
            color: #d73a49;
            font-weight: bold;
        }
        
        .source-content .marker {
            color: #005cc5;
            font-weight: bold;
        }
        
        .source-content .content-text {
            color: #24292e;
        }
        
        .source-content .comment {
            color: #6a737d;
            font-style: italic;
        }
        
        /* ========== æ—¢å­˜ã®ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆç°¡ç•¥ç‰ˆï¼‰ ========== */
        
        .container {
            max-width: 100%;
            margin: 0;
            background-color: {% if css_vars.container_background %}{{ css_vars.container_background }}{% else %}white{% endif %};
            padding: 20px;
            border-radius: 5px;
        }

        /* æ®µè½ */
        p {
            margin-bottom: 1.5em;
            text-align: justify;
        }

        /* è¦‹å‡ºã— */
        h1, h2, h3, h4, h5 {
            margin-top: 2em;
            margin-bottom: 1em;
            font-weight: bold;
            line-height: 1.4;
        }

        h1 {
            font-size: 2em;
            border-bottom: 3px solid #333;
            padding-bottom: 0.3em;
        }

        h2 {
            font-size: 1.5em;
            border-bottom: 2px solid #666;
            padding-bottom: 0.2em;
        }

        h3 {
            font-size: 1.3em;
        }

        h4 {
            font-size: 1.1em;
        }

        h5 {
            font-size: 1em;
        }

        /* ãƒªã‚¹ãƒˆ */
        ul, ol {
            margin-bottom: 1.5em;
            padding-left: 2em;
            list-style-position: outside;
        }

        li {
            margin-bottom: 0.5em;
            position: relative;
        }

        /* ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³è¦ç´  */
        strong {
            font-weight: bold;
            color: #000;
        }

        em {
            font-style: italic;
        }

        /* æ ç·š */
        .box {
            border: 2px solid #333;
            padding: 1em;
            margin: 1em 0;
            border-radius: 5px;
            background-color: #fafafa;
        }

        /* ãƒã‚¤ãƒ©ã‚¤ãƒˆ */
        .highlight {
            padding: 1em;
            margin: 1em 0;
            border-radius: 5px;
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .container {
                padding: 15px;
            }

            h1 {
                font-size: 1.5em;
            }

            h2 {
                font-size: 1.3em;
            }
            
            .source-content,
            .result-content {
                padding: 15px;
                font-size: 12px;
            }
        }

        /* æŠ˜ã‚ŠãŸãŸã¿ãƒ–ãƒ­ãƒƒã‚¯ï¼ˆdetailsè¦ç´ ï¼‰ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        details {
            margin: 1em 0;
            padding: 0;
            border: 1px solid #d0d7de;
            border-radius: 6px;
            background-color: #ffffff;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            transition: all 0.2s ease;
            overflow: hidden;
        }

        details:hover {
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            border-color: #9a9a9a;
        }

        details[open] {
            border-color: #007acc;
            box-shadow: 0 2px 8px rgba(0, 122, 204, 0.1);
        }

        details summary {
            padding: 0.8em 1em;
            font-weight: 600;
            cursor: pointer;
            background-color: #f6f8fa;
            border-radius: 5px 5px 0 0;
            user-select: none;
            transition: all 0.2s ease;
            position: relative;
            padding-left: 2.5em;
            list-style: none;
            color: #24292f;
            font-size: 1em;
            border-bottom: 1px solid #d0d7de;
        }
        
        /* Webkit browsers */
        details summary::-webkit-details-marker {
            display: none;
        }

        details[open] summary {
            background-color: #e7f3ff;
            border-bottom: 1px solid #007acc;
            color: #0969da;
        }

        details summary:hover {
            background-color: #e7f3ff;
        }

        details[open] summary:hover {
            background-color: #dbeafe;
        }

        /* å±•é–‹ã‚¢ã‚¤ã‚³ãƒ³ - æ§ãˆã‚ãªãƒ‡ã‚¶ã‚¤ãƒ³ */
        details summary::before {
            content: 'â–¶';
            position: absolute;
            left: 0.8em;
            top: 50%;
            transform: translateY(-50%);
            transition: all 0.2s ease;
            font-size: 0.8em;
            color: #656d76;
            width: auto;
            height: auto;
            line-height: 1;
        }

        details[open] summary::before {
            transform: translateY(-50%) rotate(90deg);
            color: #0969da;
        }

        /* æŠ˜ã‚ŠãŸãŸã¿ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
        details > *:not(summary) {
            padding: 1em;
            background-color: #ffffff;
            line-height: 1.7;
        }
        
        /* æŠ˜ã‚ŠãŸãŸã¿ãƒ–ãƒ­ãƒƒã‚¯å†…ã®æ®µè½ã®ãƒãƒ¼ã‚¸ãƒ³ã‚’èª¿æ•´ */
        details > p {
            margin-bottom: 1em;
        }
        
        details > p:last-child {
            margin-bottom: 0;
        }

        /* æŠ˜ã‚ŠãŸãŸã¿ãƒ–ãƒ­ãƒƒã‚¯å†…ã®æ”¹è¡Œã‚’é©åˆ‡ã«è¡¨ç¤º */
        details br {
            display: block;
            margin: 0.5em 0;
            content: "";
            line-height: 1.8;
        }
        
        /* æŠ˜ã‚ŠãŸãŸã¿ãƒ–ãƒ­ãƒƒã‚¯å†…ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆãƒ»æ ç·šã¯æœ€å°é«˜ã•ã‚’å°ã•ã */
        details .highlight,
        details .box {
            min-height: auto;
            padding: 0.8em;
        }
        
        /* æŠ˜ã‚ŠãŸãŸã¿ãƒ–ãƒ­ãƒƒã‚¯å†…ã®æ®µè½ã®ãƒãƒ¼ã‚¸ãƒ³ã‚’èª¿æ•´ */
        details .highlight p,
        details .box p {
            margin-bottom: 0.5em;
        }
        
        details .highlight p:last-child,
        details .box p:last-child {
            margin-bottom: 0;
        }

        /* ãƒã‚¿ãƒãƒ¬ãƒ–ãƒ­ãƒƒã‚¯å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        details.spoiler {
            border-color: #d73a49;
            background-color: #ffffff;
        }

        details.spoiler:hover {
            border-color: #b31d28;
        }

        details.spoiler[open] {
            border-color: #d73a49;
        }

        details.spoiler summary {
            background-color: #fff5f5;
            color: #d73a49;
            border-bottom: 1px solid #fdbdbd;
        }

        details.spoiler summary:hover {
            background-color: #fef2f2;
        }

        details.spoiler[open] summary {
            background-color: #fff1f1;
            border-bottom: 1px solid #d73a49;
        }

        details.spoiler[open] summary:hover {
            background-color: #fef2f2;
        }

        details.spoiler summary::after {
            content: 'âš ï¸';
            position: absolute;
            right: 1em;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.9em;
        }

        details.spoiler summary::before {
            color: #d73a49;
        }

        details.spoiler[open] summary::before {
            color: #d73a49;
        }

        /* ãƒ€ãƒ¼ã‚¯ãƒ†ãƒ¼ãƒã§ã®æŠ˜ã‚ŠãŸãŸã¿ãƒ–ãƒ­ãƒƒã‚¯èª¿æ•´ */
        {% if css_vars.background_color == '#1a1a1a' %}
        details {
            background-color: #2d2d2d;
            border-color: #404040;
        }

        details summary {
            background-color: #363636;
            color: #e0e0e0;
        }

        details summary:hover {
            background-color: #404040;
        }

        details.spoiler {
            background-color: #3a2f1a;
            border-color: #5a4a2a;
        }

        details.spoiler summary {
            background-color: #5a4a2a;
            color: #f0ad4e;
        }

        details.spoiler summary:hover {
            background-color: #6a5a3a;
        }
        {% endif %}
    </style>
</head>
<body>
    <!-- ã‚½ãƒ¼ã‚¹ãƒ»çµæœãƒˆã‚°ãƒ«ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« -->
    <div class="source-result-controls">
        <div class="control-row">
            <h2 class="controls-title">ğŸ“ è¨˜æ³•ã¨ğŸ¨çµæœã‚’æ¯”è¼ƒ</h2>
            <p class="controls-subtitle">æ”¹è¡Œå‡¦ç†ã®ç›´æ„Ÿæ€§ã‚’å®Ÿéš›ã«ç¢ºèªã§ãã¾ã™</p>
        </div>
        
        <!-- ãƒ¢ãƒã‚¤ãƒ«ç”¨ãƒˆã‚°ãƒ«ãƒœã‚¿ãƒ³ -->
        <div class="control-row">
            <div class="toggle-buttons">
                <button class="toggle-btn active" onclick="showResult()">ğŸ¨ çµæœã‚’è¡¨ç¤º</button>
                <button class="toggle-btn" onclick="showSource()">ğŸ“ è¨˜æ³•ã‚’è¡¨ç¤º</button>
                <button class="toggle-btn" onclick="showBoth()">â†”ï¸ ä¸¡æ–¹è¡¨ç¤º</button>
            </div>
        </div>
        
        <!-- ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«åŒæœŸãƒˆã‚°ãƒ«ï¼ˆãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã®ã¿ï¼‰ -->
        <div class="control-row desktop-only">
            <button id="sync-toggle" class="sync-toggle-btn" onclick="toggleScrollSync()">ğŸ”— åŒæœŸON</button>
            <span style="font-size: 12px; color: #6c757d; margin-left: 10px;">ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä½ç½®ã‚’è‡ªå‹•åŒæœŸ</span>
        </div>
    </div>
    
    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <div class="content-wrapper side-by-side">
        <!-- ã‚½ãƒ¼ã‚¹ãƒ“ãƒ¥ãƒ¼ -->
        <div class="source-view mobile-hidden" id="source-view">
            <div class="source-header">
                ğŸ“ ç”Ÿã®è¨˜æ³• ({{ source_filename or "sample.txt" }})
            </div>
            <div class="source-content" id="source-content">{{ source_text | e }}</div>
        </div>
        
        <!-- çµæœãƒ“ãƒ¥ãƒ¼ -->
        <div class="result-view" id="result-view">
            <div class="result-header">
                ğŸ¨ å¤‰æ›çµæœ (HTML)
            </div>
            <div class="result-content">
                {{ body_content | safe }}
            </div>
        </div>
    </div>
    
    <script>
        // ãƒ¢ãƒã‚¤ãƒ«è¡¨ç¤ºåˆ¶å¾¡
        function showResult() {
            document.getElementById('source-view').classList.add('mobile-hidden');
            document.getElementById('result-view').classList.remove('mobile-hidden');
            updateActiveButton('result');
        }
        
        function showSource() {
            document.getElementById('result-view').classList.add('mobile-hidden');
            document.getElementById('source-view').classList.remove('mobile-hidden');
            updateActiveButton('source');
        }
        
        function showBoth() {
            document.getElementById('source-view').classList.remove('mobile-hidden');
            document.getElementById('result-view').classList.remove('mobile-hidden');
            updateActiveButton('both');
        }
        
        function updateActiveButton(activeType) {
            // ãƒ¢ãƒã‚¤ãƒ«ã§ã®ã¿å®Ÿè¡Œ
            if (window.innerWidth <= 767) {
                const buttons = document.querySelectorAll('.toggle-btn');
                buttons.forEach(btn => btn.classList.remove('active'));
                
                if (activeType === 'result') {
                    buttons[0].classList.add('active');
                } else if (activeType === 'source') {
                    buttons[1].classList.add('active');
                } else if (activeType === 'both') {
                    buttons[2].classList.add('active');
                }
            }
        }
        
        // ç°¡å˜ãªã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆ
        function applySyntaxHighlighting() {
            const sourceContent = document.getElementById('source-content');
            let text = sourceContent.textContent;
            
            // ãƒ–ãƒ­ãƒƒã‚¯ãƒãƒ¼ã‚«ãƒ¼ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆ
            text = text.replace(/^;;;(.*)$/gm, '<span class="marker">;;;$1</span>');
            
            // ã‚³ãƒ¡ãƒ³ãƒˆè¡Œã®ãƒã‚¤ãƒ©ã‚¤ãƒˆ
            text = text.replace(/^#(.*)$/gm, '<span class="comment">#$1</span>');
            
            // ãƒªã‚¹ãƒˆé …ç›®ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆ  
            text = text.replace(/^- (.*)$/gm, '<span class="marker">-</span> <span class="content-text">$1</span>');
            
            sourceContent.innerHTML = text;
        }
        
        // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«åŒæœŸæ©Ÿèƒ½
        let isScrollingSynced = true;
        let scrollTimeout;
        
        function setupScrollSync() {
            const sourceContent = document.getElementById('source-content');
            const resultContent = document.querySelector('.result-content');
            
            if (!sourceContent || !resultContent) return;
            
            // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«åŒæœŸã®ã‚ªãƒ³/ã‚ªãƒ•ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹
            function toggleScrollSync() {
                isScrollingSynced = !isScrollingSynced;
                const syncButton = document.getElementById('sync-toggle');
                if (syncButton) {
                    syncButton.textContent = isScrollingSynced ? 'ğŸ”— åŒæœŸON' : 'ğŸ”— åŒæœŸOFF';
                    syncButton.style.opacity = isScrollingSynced ? '1' : '0.6';
                }
            }
            
            // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä½ç½®ã‚’åŒæœŸ
            function syncScroll(source, target) {
                if (!isScrollingSynced) return;
                
                clearTimeout(scrollTimeout);
                scrollTimeout = setTimeout(() => {
                    const sourceScrollPercentage = source.scrollTop / (source.scrollHeight - source.clientHeight);
                    const targetScrollTop = sourceScrollPercentage * (target.scrollHeight - target.clientHeight);
                    
                    // ä¸€æ™‚çš„ã«ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’ç„¡åŠ¹åŒ–ã—ã¦ç„¡é™ãƒ«ãƒ¼ãƒ—ã‚’é˜²ã
                    target.removeEventListener('scroll', targetScrollHandler);
                    target.scrollTop = targetScrollTop;
                    
                    setTimeout(() => {
                        target.addEventListener('scroll', targetScrollHandler);
                    }, 50);
                }, 10);
            }
            
            // ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼
            function sourceScrollHandler() {
                syncScroll(sourceContent, resultContent);
            }
            
            function targetScrollHandler() {
                syncScroll(resultContent, sourceContent);
            }
            
            // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¨­å®š
            sourceContent.addEventListener('scroll', sourceScrollHandler);
            resultContent.addEventListener('scroll', targetScrollHandler);
            
            // åŒæœŸãƒˆã‚°ãƒ«ãƒœã‚¿ãƒ³ã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«å…¬é–‹
            window.toggleScrollSync = toggleScrollSync;
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’é©ç”¨
        document.addEventListener('DOMContentLoaded', function() {
            applySyntaxHighlighting();
            setupScrollSync();
            
            // ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œï¼šç”»é¢ã‚µã‚¤ã‚ºå¤‰æ›´æ™‚ã®å‡¦ç†
            window.addEventListener('resize', function() {
                if (window.innerWidth > 767) {
                    // ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã§ã¯ä¸¡æ–¹è¡¨ç¤º
                    showBoth();
                }
            });
        });
    </script>
</body>
</html>