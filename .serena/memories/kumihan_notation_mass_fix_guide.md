# Kumihanè¨˜æ³• å¤§è¦æ¨¡ã‚¨ãƒ©ãƒ¼ä¿®æ­£ã‚¬ã‚¤ãƒ‰

> Issue #726 (2025-08-02) ã§ã®516-2595ã‚¨ãƒ©ãƒ¼å®Œå…¨è§£æ±ºçµŒé¨“ã‚’ãƒ™ãƒ¼ã‚¹ã¨ã—ãŸå®Ÿè·µçš„ä¿®æ­£æ‰‹é †

## ğŸ¯ ä¿®æ­£æˆ¦ç•¥ã®åŸºæœ¬åŸå‰‡

### æ®µéšçš„ã‚¨ãƒ©ãƒ¼æ¸›å°‘ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ
- **ä¸€åº¦ã«å…¨ä¿®æ­£ã‚’ç‹™ã‚ãªã„** - æ®µéšçš„ã«ç¢ºå®Ÿã«ã‚¨ãƒ©ãƒ¼ã‚’æ¸›ã‚‰ã™
- **ä¿®æ­£çµæœã‚’å³åº§ã«æ¤œè¨¼** - `python3 -m kumihan_formatter check-syntax` ã§åŠ¹æœç¢ºèª
- **å®‰å…¨ãªå·»ãæˆ»ã—ç¢ºä¿** - `git checkout HEAD -- ãƒ•ã‚¡ã‚¤ãƒ«å` ã§ã„ã¤ã§ã‚‚å¾©æ—§å¯èƒ½

### å®Ÿç¸¾ãƒ‘ã‚¿ãƒ¼ãƒ³ (Issue #726)
```
12_heavy_decoration_7k.txt: 2595 â†’ 516 â†’ 83 â†’ 30 â†’ 0 (100%è§£æ±º)
11_complex_nested_5k.txt:    2241 â†’ 1225 â†’ 219 â†’ 0 (100%è§£æ±º)
```

## ğŸ”§ ä¿®æ­£ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

### åŸºæœ¬æ§‹é€ 
```python
#!/usr/bin/env python3
"""
{å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«}ç”¨ã®ä¿®æ­£ã‚¹ã‚¯ãƒªãƒ—ãƒˆ - {å…·ä½“çš„ãªä¿®æ­£å†…å®¹}
"""
import re
import sys
from pathlib import Path

def fix_patterns(content: str) -> str:
    """ä¿®æ­£ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å®Ÿè£…"""
    
    # å…¨è§’ãƒãƒ¼ã‚«ãƒ¼ã‚’åŠè§’ã«çµ±ä¸€ï¼ˆå¿…é ˆå‰å‡¦ç†ï¼‰
    content = content.replace('ï¼ƒ', '#')
    
    # ãƒ‘ã‚¿ãƒ¼ãƒ³1: å…·ä½“çš„ä¿®æ­£ãƒ­ã‚¸ãƒƒã‚¯
    content = re.sub(r'ãƒ‘ã‚¿ãƒ¼ãƒ³æ­£è¦è¡¨ç¾', r'ç½®æ›å¾Œ', content)
    
    return content

def main():
    """ãƒ¡ã‚¤ãƒ³å‡¦ç† - è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«å¯¾å¿œ"""
    files = [
        "samples/performance/ãƒ•ã‚¡ã‚¤ãƒ«1.txt",
        "samples/practical/ãƒ•ã‚¡ã‚¤ãƒ«2.txt"
    ]
    
    for file_path_str in files:
        file_path = Path(file_path_str)
        
        if not file_path.exists():
            print(f"âš ï¸  File not found: {file_path}")
            continue
            
        print(f"Processing: {file_path}")
        
        # å®‰å…¨ãªèª­ã¿æ›¸ãå‡¦ç†
        try:
            with open(file_path, 'r', encoding='utf-8') as f:
                original_content = f.read()
        except Exception as e:
            print(f"Error reading file: {e}")
            continue
        
        fixed_content = fix_patterns(original_content)
        
        try:
            with open(file_path, 'w', encoding='utf-8') as f:
                f.write(fixed_content)
            print(f"âœ… Fixed: {file_path}")
        except Exception as e:
            print(f"Error writing file: {e}")
            continue

if __name__ == "__main__":
    main()
```

## ğŸ“‹ å®Ÿè¨¼æ¸ˆã¿ä¿®æ­£ãƒ‘ã‚¿ãƒ¼ãƒ³é›†

### 1. 16é€²æ•°ã‚«ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰å•é¡Œ
```python
# ãƒ‘ã‚¿ãƒ¼ãƒ³: ãƒ—ãƒ©ã‚¤ãƒãƒªã‚«ãƒ©ãƒ¼ã¯#4169e1ã€ â†’ ãƒ—ãƒ©ã‚¤ãƒãƒªã‚«ãƒ©ãƒ¼ã¯è‰²ã‚³ãƒ¼ãƒ‰4169e1ã€
content = re.sub(r'([ã-ã‚“]|[ã‚¡-ãƒ´]|[ä¸€-é¾¯]|[a-zA-Z0-9])#([0-9a-fA-F]{6})([ã€ã€‚ã‚’])', r'\1è‰²ã‚³ãƒ¼ãƒ‰\2\3', content)
content = re.sub(r'ã¯\s*#([0-9a-fA-F]{6})', r'ã¯è‰²ã‚³ãƒ¼ãƒ‰\1', content)
content = re.sub(r'(?<!\w)#([0-9a-fA-F]{6})(?!\w)', r'è‰²ã‚³ãƒ¼ãƒ‰\1', content)
```

### 2. ä¸æ­£##ãƒãƒ¼ã‚«ãƒ¼é™¤å»
```python
# ãƒ‘ã‚¿ãƒ¼ãƒ³: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹##ã€‚ â†’ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã€‚
content = re.sub(r'([ã-ã‚“]|[ã‚¡-ãƒ´]|[ä¸€-é¾¯]|[a-zA-Z0-9])\s*##\s*([ã€‚ã€ï¼ï¼Ÿ])', r'\1\2', content)
content = re.sub(r'ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹\s*##\s*ã€‚', 'ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã€‚', content)
```

### 3. æœªå®Œäº†ãƒãƒ¼ã‚«ãƒ¼ â†’ ãƒ–ãƒ­ãƒƒã‚¯è¨˜æ³•å¤‰æ›
```python
# ãƒ‘ã‚¿ãƒ¼ãƒ³: ã‚¤ã‚¿ãƒªãƒƒã‚¯ # 85% â†’ ã‚¤ã‚¿ãƒªãƒƒã‚¯ #\n85%\n##
content = re.sub(
    r'^(\s*)([^#\n]+)\s*#\s*(\d+%)$',
    r'\1\2 #\n\1\3\n\1##',
    content,
    flags=re.MULTILINE
)
```

### 4. colorå±æ€§ä»˜ãä¿®æ­£
```python
# ãƒ‘ã‚¿ãƒ¼ãƒ³: color=è‰²ã‚³ãƒ¼ãƒ‰008000 # ä¸‹ç·šè£…é£¾ â†’ ãƒ–ãƒ­ãƒƒã‚¯åŒ–
content = re.sub(
    r'(color=è‰²ã‚³ãƒ¼ãƒ‰[0-9a-fA-F]{6})\s*#\s*([^#\n]+)',
    r'\1 #\n\2\n##',
    content
)
```

### 5. è£…é£¾ä¾‹æ–‡ãƒ‘ã‚¿ãƒ¼ãƒ³
```python
# ãƒ‘ã‚¿ãƒ¼ãƒ³: ##è‰²ã‚³ãƒ¼ãƒ‰000080è‰²ã‚’ä½¿ç”¨ã—ãŸè£…é£¾ã®ä¾‹ã¨ã—ã¦ã€ â†’ è‰²ã‚³ãƒ¼ãƒ‰000080è‰²ã‚’ä½¿ç”¨ã—ãŸè£…é£¾ã®ä¾‹ã¨ã—ã¦ã€
content = re.sub(
    r'##è‰²ã‚³ãƒ¼ãƒ‰([0-9a-fA-F]{6})è‰²ã‚’ä½¿ç”¨ã—ãŸ([^#\n]+)',
    r'è‰²ã‚³ãƒ¼ãƒ‰\1è‰²ã‚’ä½¿ç”¨ã—ãŸ\2',
    content
)
```

## ğŸ“Š åŠ¹ç‡çš„æ¤œè¨¼ãƒ•ãƒ­ãƒ¼

### ä¿®æ­£å‰ã‚¨ãƒ©ãƒ¼æ•°ç¢ºèª
```bash
python3 -m kumihan_formatter check-syntax ãƒ•ã‚¡ã‚¤ãƒ«å.txt
```

### ä¿®æ­£å®Ÿè¡Œ
```bash
python3 fix_ã‚¹ã‚¯ãƒªãƒ—ãƒˆå.py
```

### ä¿®æ­£å¾Œçµæœç¢ºèª
```bash
python3 -m kumihan_formatter check-syntax ãƒ•ã‚¡ã‚¤ãƒ«å.txt
```

### å•é¡Œç™ºç”Ÿæ™‚ã®å·»ãæˆ»ã—
```bash
git checkout HEAD -- ãƒ•ã‚¡ã‚¤ãƒ«å.txt
```

## ğŸ¯ TodoWriteæ´»ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³

```python
# ä¿®æ­£ä½œæ¥­ã®é€²æ—ç®¡ç†
todos = [
    {"content": "ã‚¨ãƒ©ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æ", "status": "in_progress", "priority": "high", "id": "analyze"},
    {"content": "16é€²æ•°ã‚«ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ä¿®æ­£", "status": "pending", "priority": "high", "id": "fix_colors"},
    {"content": "ä¸æ­£##ãƒãƒ¼ã‚«ãƒ¼ä¿®æ­£", "status": "pending", "priority": "high", "id": "fix_markers"},
    {"content": "æœ€çµ‚ã‚¼ãƒ­ã‚¨ãƒ©ãƒ¼ç¢ºèª", "status": "pending", "priority": "high", "id": "final_check"}
]
```

## ğŸš¨ æ³¨æ„äº‹é …ãƒ»å¤±æ•—å›é¿

### é¿ã‘ã‚‹ã¹ãä¿®æ­£ãƒ‘ã‚¿ãƒ¼ãƒ³
- **éåº¦ã«æ±ç”¨çš„ãªæ­£è¦è¡¨ç¾** - äºˆæœŸã—ãªã„ç½®æ›ãŒç™ºç”Ÿ
- **ä¸€åº¦ã®å¤§é‡ä¿®æ­£** - ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã®åŸå› ç‰¹å®šå›°é›£
- **ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãªã—ä¿®æ­£** - Gitç®¡ç†ä¸‹ã§ä½œæ¥­å¿…é ˆ

### æˆåŠŸè¦å› 
- **å…·ä½“çš„ãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ®µéšçš„ä¿®æ­£** - 1ã¤ãšã¤ç¢ºå®Ÿã«
- **å³åº§ã®çµæœæ¤œè¨¼** - ä¿®æ­£åŠ¹æœã®å®šé‡çš„ç¢ºèª
- **å®‰å…¨ãªå·»ãæˆ»ã—æ©Ÿèƒ½** - git checkoutæ´»ç”¨

## ğŸ“ˆ åŠ¹æœæ¸¬å®š

### Issue #726å®Ÿç¸¾
- **ç·ã‚¨ãƒ©ãƒ¼æ•°**: 4836å€‹ â†’ 0å€‹ (100%è§£æ±º)
- **ä½œæ¥­æ™‚é–“**: è¤‡æ•°ã‚»ãƒƒã‚·ãƒ§ãƒ³
- **ä¿®æ­£ã‚¹ã‚¯ãƒªãƒ—ãƒˆæ•°**: 7å€‹
- **æˆåŠŸè¦å› **: æ®µéšçš„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ + ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æ

---
*âœ¨ 2025-08-02 Issue #726å®Œå…¨è§£æ±ºçµŒé¨“ã‚ˆã‚ŠæŠ½å‡º - å¤§è¦æ¨¡è¨˜æ³•ä¿®æ­£ã®å®Ÿè·µçš„ã‚¬ã‚¤ãƒ‰*