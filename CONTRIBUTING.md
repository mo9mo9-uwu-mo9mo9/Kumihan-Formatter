# CONTRIBUTING.md

Kumihan-Formatter への貢献ガイドライン

## 開発参加の方法

### 1. Issue の作成
- バグ報告や機能提案は Issue で行ってください
- 既存の Issue を確認してから新規作成してください
- Issue には適切な Label を付与して管理してください

### 2. Pull Request
- `main` ブランチへの直接コミットは避けてください
- 機能ブランチを作成して作業してください
- PR にはテスト結果を含めてください
- PR のレビューは Claude が行ってください
- PR のレビュー結果に問題がなければ、そのままマージを行ってください
- レビューの結果については、PR にコメントを残してください
- Issue に基づいて作業を行った場合、作業結果をそのIssue にコメントしてください
- PR のマージ後は Close できる Issue があるかどうかを確認してください

#### PR レビューコメントの記載方法
- レビュー観点と確認結果を明記してください
- OK の場合：なぜ OK なのか理由を記述してください
- NG の場合：問題点と修正すべき内容を具体的に記述してください
- 人間のレビュアーと同様に、建設的なフィードバックを心がけてください

##### レビューコメント例（OK の場合）
```
## レビュー結果: ✅ Approved

### レビュー観点
1. **コード品質**: 既存のコーディング規約に準拠しているか
2. **テスト**: 変更に対する適切なテストが実施されているか
3. **ドキュメント**: 必要な更新が行われているか
4. **影響範囲**: 他の機能への影響がないか

### 確認結果
- ✅ Black によるフォーマットが適用されている
- ✅ 型ヒントが適切に使用されている
- ✅ テストが全てパスしている（make test で確認）
- ✅ 変更内容が Issue #XXX の要件を満たしている

このPRは問題なくマージ可能です。
```

##### レビューコメント例（NG の場合）
```
## レビュー結果: ❌ Changes Requested

### レビュー観点と問題点
1. **テスト不足**: 新規追加した機能に対するテストケースがありません
   - `src/new_feature.py` の `process_data()` メソッドのテストを追加してください

2. **エラーハンドリング**: 異常系の処理が不十分です
   - ファイル読み込み失敗時の例外処理を追加してください（src/utils.py:45）

3. **型ヒント**: 一部の関数で戻り値の型が未定義です
   - `calculate_total()` メソッドの戻り値型を追加してください

修正後、再度レビューします。
```

### 3. Issue駆動開発ワークフロー
- Issue 確認・分析後、「作業中」ラベルを付与してください
- ブランチ作成: `git checkout -b feature/issue-{番号}-{概要}` または `git checkout -b fix/issue-{番号}-{概要}`
- 実装・テスト実行
- コミット・プッシュの実行
- PR 作成（本文に `Closes #issue番号` を記載）
- レビュー・マージ実行
- Issue への完了報告・クローズ実行

### 4. コーディング規約
- Python 3.8+ 対応
- Black でコードフォーマット
- 型ヒントを積極的に使用
- 主要クラスの冒頭に、設計ドキュメントへの参照と、関連クラスのメモを、コメントとして付与する

### 5. Commit
- Commit 後はリモートへの Push を行ってください
- PR を作成するタイミングは Issue の問題が全て解決した Commit 後のタイミングとしてください
- Commit 前には必ず一時ファイルや不要な変更を削除してください
- 削除対象ファイル・ディレクトリ:
  - `.pytest_cache/`, `.tmp.*/` - キャッシュ・一時ファイル
  - `*test*.html`, `*test*/` - テスト用出力ファイル・ディレクトリ
  - `dist/test_*`, `*-output/` - テスト用出力ファイル
  - `__pycache__/`, `*.pyc`, `*.log` - Python一時ファイル

### 6. Issue の管理
- Issue にコメントを追加したと言われた場合には、該当するコメントを確認すること
- Issue 開始時は該当 Issue に「作業中」ラベルを付与してください
- 作業完了時は作業内容を詳細にコメントで報告してください
- 完全完了時は「完了待ち」ラベル付与後、Issue をクローズしてください
- PR を伴わない作業（ドキュメント更新、設定変更、ラベル追加等）も同様に管理してください
- 部分完了の場合は残作業を明記し、継続判断を行ってください

### 7. Claude の Issue 処理フロー

#### 基本フロー
Issue確認・分析 → 「作業中」ラベル付与 → 作業実行 → 完了コメント報告 → ラベル更新 → クローズ判定

#### 詳細手順
1. **Issue対応開始時（必須）**
   - CONTRIBUTING.mdの内容を確認
   - Issue番号と内容を確認
   - 「作業中」ラベルを付与
   - ブランチを作成: `git checkout -b fix/issue-{番号}-{概要}` または `feature/issue-{番号}-{概要}`
   - **注意**: mainブランチは保護されているため、必ずブランチを作成してから作業する

2. **作業実行時**
   - TodoListに必ず以下を含める:
     - [ ] CONTRIBUTING.md確認
     - [ ] Issue確認・「作業中」ラベル付与
     - [ ] ブランチ作成
     - [ ] 実装作業
     - [ ] テスト実行
     - [ ] コミット・プッシュ
     - [ ] PR作成（Closes #XXX）
     - [ ] レビュー・マージ
     - [ ] Issue完了報告・クローズ

3. **注意事項**
   - **mainブランチへの直接コミットは禁止**（mainブランチは保護されており直接プッシュ不可）
   - 「マージまで」と指示された場合も、必ず正規のワークフローに従う
   - Issue番号が言及されたら、即座にCONTRIBUTING.mdを確認する
   - **重要**: mainブランチは保護されているため、全ての変更は必ずブランチを作成してPR経由で行う

## ブランチ戦略

- `main`: 安定版
- `feature/*`: 新機能開発
- `fix/*`: バグ修正

## テスト

```bash
make test
```

## リンター

```bash
make lint
```

## ドキュメント

- 変更内容は CHANGELOG.md に記録
- API 変更時は docs/ を更新
- API 変更時は ./README.mdを更新
